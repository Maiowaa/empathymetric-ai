services:
  - type: web
    name: empathymetric-ai
    env: python
    plan: free
    buildCommand: |
      echo "Installing dependencies..."
      pip install -r requirements.txt
      pip install huggingface-hub
      
      echo "Downloading model..."
      python3 -c "from huggingface_hub import snapshot_download; snapshot_download('j-hartmann/emotion-english-distilroberta-base', local_dir='./model', local_dir_use_symlinks=False); print('Model downloaded!')"
      
      echo "Verifying model..."
      ls -la model/
      test -f model/config.json || exit 1
      
    startCommand: uvicorn app:app --host 0.0.0.0 --port $PORT
    
    envVars:
      - key: MODEL_PATH
        value: ./model
