services:
  - type: web
    name: empathymetric-ai
    env: python
    plan: free
    buildCommand: |
      echo "üì¶ Installing dependencies..."
      pip install -r requirements.txt
      pip install gdown
      
      echo "üóëÔ∏è Cleaning up old files..."
      rm -f emotion_model_production.zip
      rm -rf model emotion_model_production
      
      echo "‚¨áÔ∏è Downloading model..."
      gdown https://drive.google.com/uc?id=1Tz2caKaZTFJ9Tp5-84_Lyxca1YhyDqfF
      
      echo "üìÇ Extracting model..."
      unzip -q emotion_model_production.zip
      
      echo "üìÅ Setting up model directory..."
      if [ -d "emotion_model_production" ]; then
        mv emotion_model_production model
      fi
      
      echo "‚úÖ Verifying model files..."
      ls -la model/
      
      echo "üîç Checking for required files..."
      if [ ! -f "model/config.json" ]; then
        echo "‚ùå config.json not found!"
        exit 1
      fi
      if [ ! -f "model/tokenizer.json" ]; then
        echo "‚ùå tokenizer.json not found!"
        exit 1
      fi
      
      echo "‚úÖ Model setup complete!"
      
    startCommand: uvicorn app:app --host 0.0.0.0 --port $PORT
    
    envVars:
      - key: PYTHON_VERSION
        value: "3.10"
      - key: MODEL_PATH
        value: ./model
